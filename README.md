# Bismarck Android APK Toolkit

Bismarck collects a master inventory of installed applications from an
Android device. It highlights social apps and other metadata to help you
triage a device quickly.

## Overview

- Enumerates packages via `adb shell pm list packages -f` across all
  partitions.
- Builds a single `apps_master.csv` with paths, versions, permissions,
  hashes, and running state. The column schema is documented in
  [`docs/apps_master_schema.md`](docs/apps_master_schema.md).
- Records version, SDK levels, size, and permissions for each package in
  `apk_metadata.csv` to seed static analysis and ML workflows.
- Places all artifacts under `output/<serial>/`.

## How it works

1. The script binds to the chosen device and performs health checks.
2. Package discovery populates the master inventory.
3. Social triage marks packages using exact matches and keyword heuristics.
4. SHA-256 hashes are attempted on-device or on the host and recorded with
   their source.
5. A summary report captures counts and social hits for the run.

## How to run

### Interactive menu

```bash
./run.sh
```

Prompts for a device, then displays a numbered menu:

- `1` Generate APK list
- `2` Find social apps
- `3` List Motorola apps
- `4` Compute APK hashes
- `5` Extract APK metadata
- `6` List running processes
- `7` Pull TikTok APK
- `8` Capture screenshot
- `9` Open interactive shell
- `10` Run all steps
- `11` Switch device
- `12` View social report
- `13` View Motorola report
- `0` Exit

Artifacts and a timestamped `run_<timestamp>.log` are stored under
`output/<serial>/`.

### Running step scripts directly

Each step can be invoked on its own for scripting or debugging. Provide the
device serial with `-d <serial>`:

- `steps/generate_apk_list.sh` – write `apk_list.csv` with package paths.
- `steps/generate_apk_metadata.sh` – capture version, SDK levels, size, and
  permissions in `apk_metadata.csv`.
- `steps/generate_apk_hashes.sh` – compute SHA-256 hashes into
  `apk_hashes.csv`.
- `steps/generate_running_apps.sh` – log running processes to
  `running_apps.csv`.
- `steps/generate_manifest.sh -l <log_file>` – produce `manifest.json` summary.
- `find_social_apps.sh` – flag social apps into `social_apps_found.csv`.
- `find_motorola_apps.sh` – list Motorola apps in `motorola_apps.csv`.

### Pulling and profiling a single APK

Use `./pull_tiktok_apk.sh -p <package>` to grab an APK from the device. When
`aapt` is available, static features such as SDK levels, size, and declared
permissions are written to `<package>_features.csv` alongside the pulled files.

## Supporting and contributing

- File issues or feature requests on the repository to report bugs or ask
  questions.
- Before submitting a pull request, run `bash -n` and `shellcheck` on
  modified scripts to ensure they pass basic validation.
- Contributions that expand device coverage or improve data quality are
  welcome.

## What to look for

After completion, check `output/<serial>/manifest.json` for counts and a list of
detected social apps. The directory also holds:

- `apk_list.csv`, `apk_metadata.csv`, `apk_hashes.csv`, and `running_apps.csv`
- `social_apps_found.csv` and `motorola_apps.csv` when those scans run
- `run_<timestamp>.log` capturing console output

Raw command outputs are in `raw/`, pulled APKs in `apks/`, and additional
reports in `reports/`. Optional derived CSV views (social or running apps) can
be generated by enabling `GENERATE_DERIVED` in `config.sh`; these files are
suffixed with `_derived` and reside alongside the master inventory.

## Planned features

- Per-run IDs for multiple captures under `output/<serial>/<run-id>/`
- `latest` symlink pointing to the most recent run
- Non-interactive flag for automated full scans

## Troubleshooting

- "No device selected": ensure exactly one device is connected or use
  `--device <serial>`.
- "Device unhealthy": the script could not communicate with the selected
  device after restarting the ADB server.
- "hash failed (no access)": the APK could not be read; device or filesystem
  permissions may block access.
