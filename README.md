# Bismarck Android APK Toolkit

Bismarck collects a master inventory of installed applications from an
Android device. It highlights social apps and other metadata to help you
triage a device quickly.

## Overview

- Enumerates packages via `adb shell pm list packages -f` across all
  partitions.
- Builds a single `apps_master.csv` with paths, versions, permissions,
  hashes, and running state. The column schema is documented in
  [`docs/apps_master_schema.md`](docs/apps_master_schema.md).
- Records version, SDK levels, size, and permissions for each package in
  `apk_metadata.csv` to seed static analysis and ML workflows.
- Places all artifacts under `output/<serial>/<run-id>/` with a `latest`
  symlink for quick access.

## How it works

1. The script binds to the chosen device and performs health checks.
2. Package discovery populates the master inventory.
3. Social triage marks packages using exact matches and keyword heuristics.
4. SHA-256 hashes are attempted on-device or on the host and recorded with
   their source.
5. A summary report captures counts and social hits for the run.

## How to run

### Interactive full scan
```
./run.sh
```
Prompts for a device and executes the full pipeline, storing artifacts under `output/<serial>/<run-id>/` and updating `output/<serial>/latest`.

### Headless full scan
```
./run.sh --non-interactive
```
Runs the same pipeline without prompts, useful for scripting or CI.

### Targeted steps
Currently the script executes all stages sequentially. Future iterations will allow running individual steps.

### Pulling and profiling a single APK
Use `./pull_tiktok_apk.sh -p <package>` to grab an APK from the device.
When `aapt` is available, static features such as SDK levels, size, and
declared permissions are written to `<package>_features.csv` alongside the
pulled files.

## Supporting and contributing

- File issues or feature requests on the repository to report bugs or ask
  questions.
- Before submitting a pull request, run `bash -n` and `shellcheck` on
  modified scripts to ensure they pass basic validation.
- Contributions that expand device coverage or improve data quality are
  welcome.
 
## What to look for
After completion, check the summary file `output/<serial>/<run-id>/<serial>.<run-id>.summary.txt` for counts and a list of detected social apps. All raw command outputs are in the `raw/` folder, pulled APKs in `apks/`, and additional reports in `reports/`.
Optional derived CSV views (social or running apps) can be generated by enabling `GENERATE_DERIVED` in `config.sh`; these files are suffixed with `_derived` and reside alongside the master inventory.

## Troubleshooting
- "No device selected": ensure exactly one device is connected or use `--device <serial>`.
- "Device unhealthy": the script could not communicate with the selected device after restarting the ADB server.
- "hash failed (no access)": the APK could not be read; device or filesystem permissions may block access.
